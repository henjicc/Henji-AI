# 文生图

文生图 API 能基于用户输入的内容，生成符合语义描述的图片。

## 请求头

### Content-Type
*   **类型**: `string`
*   **必需**: 是
*   **枚举值**: `application/json`

### Authorization
*   **类型**: `string`
*   **必需**: 是
*   **描述**: Bearer 身份验证格式，例如：`Bearer {{API 密钥}}`。

## 请求体

### extra
*   **类型**: `object`
*   **描述**: 请求的可选 extra 参数。

#### response_image_type
*   **类型**: `string`
*   **描述**: 返回的图片格式，默认为 PNG。
*   **枚举值**: `png`, `webp`, `jpeg`

### request
*   **类型**: `object`
*   **必需**: 是

#### model_name
*   **类型**: `string`
*   **必需**: 是
*   **描述**: 可以调用 `/v3/model` 接口并指定请求参数 `filter.types=checkpoint` 来获取可用模型列表。

#### prompt
*   **类型**: `string`
*   **必需**: 是
*   **描述**: 提示词，用于指导图像生成的文本输入，文本长度范围 [1, 1024]。

#### width
*   **类型**: `integer`
*   **必需**: 是
*   **描述**: 生成图片的宽度，取值范围：[128, 2048]。

#### height
*   **类型**: `integer`
*   **必需**: 是
*   **描述**: 生成图片的高度，取值范围：[128, 2048]。

#### image_num
*   **类型**: `integer`
*   **必需**: 是
*   **描述**: 生成图片的数量，取值范围：[1, 8]。

#### steps
*   **类型**: `integer`
*   **必需**: 是
*   **描述**: 迭代步数，图片创建过程的迭代数，取值范围：[1, 100]。

#### guidance_scale
*   **类型**: `number` (float32)
*   **必需**: 是
*   **描述**: 提示词引导系数，取值越大越接近于提示词描述，取值范围：[1, 30]。

#### sampler_name
*   **类型**: `string`
*   **必需**: 是
*   **描述**: 指定采样器。
*   **枚举值**: `Euler a`, `Euler`, `LMS`, `Heun`, `DPM2`, `DPM2 a`, `DPM++ 2S a`, `DPM++ 2M`, `DPM++ SDE`, `DPM fast`, `DPM adaptive`, `LMS Karras`, `DPM2 Karras`, `DPM2 a Karras`, `DPM++ 2S a Karras`, `DPM++ 2M Karras`, `DPM++ SDE Karras`, `DDIM`, `PLMS`, `UniPC`

#### negative_prompt
*   **类型**: `string`
*   **描述**: 反向提示词，文本长度范围 [0, 1024]。

#### sd_vae
*   **类型**: `string`
*   **描述**: 模型 VAE(Variational Auto Encoder)，可以调用 `/v3/model` 接口并指定请求参数 `filter.types=vae` 来获取可用模型列表。

#### seed
*   **类型**: `integer`
*   **描述**: 随机数种子，稳定扩散产生噪声的数字，取值范围：>= -1。默认值为 -1。

#### loras
*   **类型**: `object[]`
*   **描述**: LoRA 模型，最多支持指定 5 个。

##### model_name
*   **类型**: `string`
*   **必需**: 是
*   **描述**: 可以调用 `/v3/model` 接口并指定请求参数 `filter.types=lora` 来获取可用模型列表，如果 Checkpoint 为 SDXL 模型时，请额外指定请求参数 `filter.types=lora&filter.is_sdxl=true` 来获取可用模型列表。

##### strength
*   **类型**: `number` (float32)
*   **必需**: 是
*   **描述**: LoRA 的权重值，值越大，LoRA 效果更明显，取值范围：[0, 1]。

#### embeddings
*   **类型**: `object[]`
*   **描述**: Textual Inversion 模型，最多支持 5 个。

##### model_name
*   **类型**: `string`
*   **必需**: 是
*   **描述**: 可以调用 `/v3/model` 接口并指定请求参数 `filter.types=textualinversion` 来获取可用模型列表。

#### hires_fix
*   **类型**: `object`
*   **描述**: 高清修复选项。

##### target_width
*   **类型**: `integer`
*   **必需**: 是
*   **描述**: 目标图片宽度，取值范围：[128, 4096]。

##### target_height
*   **类型**: `integer`
*   **必需**: 是
*   **描述**: 目标图片高度，取值范围：[128, 4096]。

##### strength
*   **类型**: `number` (float32)
*   **必需**: 是
*   **描述**: 定义`超分`模型效果的强度。值为 0 表示放大器没有效果，而 1 则表示最大强度，充分利用放大器的能力，取值范围：[0, 1]。

##### upscaler
*   **类型**: `string`
*   **描述**: 选择超分模型。
*   **枚举值**: `RealESRGAN_x4plus_anime_6B`, `RealESRNet_x4plus`, `Latent`

#### refiner
*   **类型**: `object`
*   **描述**: Refiner 信息，用作增强图片细节。

##### switch_at
*   **类型**: `number` (float32)
*   **必需**: 是
*   **描述**: Refiner 的权重。当设置为 0 时，Refiner 没有效果；设置为 1 时，Refiner 完全激活。中间值如 0.5 提供平衡效果，Refiner 适度参与，增强或调整输出而不主导原始模型的特征。此设置对于微调输出以实现 Refiner 与原始生成特征之间的理想平衡特别有用，取值范围：[0, 1]。

#### clip_skip
*   **类型**: `integer` | `null`
*   **描述**: CLIP 跳过层数，取值范围：[1, 12]。

#### enable_transparent_background
*   **类型**: `bool`
*   **描述**: 使生成图像的背景透明。请注意，如果启用 `transparent_background`，则请求参数 `response_image_type` 必须指定为 PNG，并且 Checkpoint 只能指定为 SDXL 模型。

#### restore_faces
*   **类型**: `bool`
*   **描述**: 用于控制是否启用面部修复功能。

## 响应参数

### task_id
*   **类型**: `string`
*   **必需**: 是
*   **描述**: 异步任务的 task_id。您应该使用该 task_id 请求 [查询任务结果 API](/docs/models/reference-get-async-task-result) 以获取生成结果。

## 请求示例

```bash
curl --request POST \
  --url https://api.ppinfra.com/v3/async/txt2img \
  --header 'Authorization: <authorization>' \
  --header 'Content-Type: application/json' \
  --data '
{
  "extra": {
    "response_image_type": "png"
  },
  "request": {
    "model_name": "<string>",
    "prompt": "<string>",
    "width": 512,
    "height": 512,
    "image_num": 1,
    "steps": 20,
    "guidance_scale": 7.5,
    "sampler_name": "Euler a",
    "negative_prompt": "<string>",
    "sd_vae": "<string>",
    "seed": -1,
    "loras": [
      {
        "model_name": "<string>",
        "strength": 0.8
      }
    ],
    "embeddings": [
      {
        "model_name": "<string>"
      }
    ],
    "hires_fix": {
      "target_width": 1024,
      "target_height": 1024,
      "strength": 0.7,
      "upscaler": "RealESRGAN_x4plus_anime_6B"
    },
    "refiner": {
      "switch_at": 0.5
    },
    "clip_skip": 2,
    "enable_transparent_background": false,
    "restore_faces": true
  }
}
'
```

## 响应示例

```json
{
  "task_id": "<string>"
}
```