# 局部重绘

局部重绘 API 用于控制图片中指定区域的内容被重新绘制。

## 请求头

| 参数名 | 类型 | 是否必需 | 描述 |
| :--- | :--- | :--- | :--- |
| `Content-Type` | string | 是 | 必须为 `application/json`。 |
| `Authorization` | string | 是 | Bearer 身份验证格式，例如：`Bearer {{API 密钥}}`。 |

## 请求体

### `extra` (object)
请求的可选额外参数。

**属性：**
*   `response_image_type` (string): 返回的图片格式，默认为 PNG。可选值：`png`, `webp`, `jpeg`。

### `request` (object) [必需]
生成请求的主要参数。

**属性：**
*   `model_name` (string) [必需]: 仅支持 Inpainting 模型。可通过调用 `/v3/model` 接口并指定请求参数 `filter.types=checkpoint&filter.is_inpainting=1` 来获取可用模型列表。
*   `image_base64` (string) [必需]: 原始图片二进制的 base64 内容。图片长和宽均不超过 2048 像素，文件最大不超过 30 MB。
*   `mask_image_base64` (string) [必需]: 遮罩图片二进制的 base64 内容。图片长和宽均不超过 2048 像素，文件最大不超过 30 MB。
*   `prompt` (string) [必需]: 正向提示词，用于指导图像生成的文本输入。文本长度范围：[1, 1024]。
*   `image_num` (integer) [必需]: 生成图片的数量。取值范围：[1, 8]。
*   `steps` (integer) [必需]: 迭代步数，即图片创建过程的迭代次数。取值范围：[1, 100]。
*   `guidance_scale` (number) [必需]: 提示词引导系数，值越大生成结果越接近提示词描述。number(float32) 类型，取值范围：[1, 30]。
*   `sampler_name` (string) [必需]: 指定采样器。可选值：`Euler a`, `Euler`, `LMS`, `Heun`, `DPM2`, `DPM2 a`, `DPM++ 2S a`, `DPM++ 2M`, `DPM++ SDE`, `DPM fast`, `DPM adaptive`, `LMS Karras`, `DPM2 Karras`, `DPM2 a Karras`, `DPM++ 2S a Karras`, `DPM++ 2M Karras`, `DPM++ SDE Karras`, `DDIM`, `PLMS`, `UniPC`。
*   `mask_blur` (integer): 遮罩模糊尺寸（像素）。较低的值会导致边缘更清晰，较高的值会创建更平滑的过渡。取值范围：[0, 64]。
*   `negative_prompt` (string): 反向提示词，文本长度范围：[0, 1024]。
*   `sd_vae` (string): 模型 VAE (Variational Auto Encoder)。可通过调用 `/v3/model` 接口并指定请求参数 `filter.types=vae` 来获取可用模型列表。
*   `seed` (integer): 随机数种子，用于稳定扩散产生噪声。取值范围：>= -1。默认值为 -1。
*   `loras` (object[]): LoRA 模型列表，最多支持指定 5 个。
    *   `model_name` (string) [必需]: LoRA 模型名称。可通过调用 `/v3/model` 接口并指定请求参数 `filter.types=lora` 来获取可用模型列表。如果 Checkpoint 为 SDXL 模型，请额外指定 `filter.is_sdxl=true`。
    *   `strength` (number) [必需]: LoRA 的权重值，值越大效果越明显。number(float32) 类型，取值范围：[0, 1]。
*   `embeddings` (object[]): Textual Inversion 模型列表，最多支持 5 个。
    *   `model_name` (string) [必需]: 模型名称。可通过调用 `/v3/model` 接口并指定请求参数 `filter.types=textualinversion` 来获取可用模型列表。
*   `clip_skip` (integer \| null): CLIP 跳过层数。取值范围：[1, 12]。
*   `strength` (number(float) \| null): 控制对原始图片的调整幅度。值越大，调整幅度越大，与原始图片差异越大。取值范围：(0, 1]。
*   `inpainting_full_res` (integer): 控制修复范围。设置为 `0` 时，修复过程考虑整个图像，使遮罩区域与图像整体更融合；设置为 `1` 时，仅填充遮罩区域。默认值为 `0`。可选值：`0`, `1`。
*   `inpainting_full_res_padding` (integer): 修复区域填充像素。增加此值可能会降低输出质量。取值范围：[0, 256]，默认值为 8。
*   `inpainting_mask_invert` (integer): 是否反转遮罩。为 `1` 时表示反转。默认值为 `0`。可选值：`0`, `1`。
*   `initial_noise_multiplier` (number): 初始噪声乘数，有助于减少输出图像中的闪烁或不稳定性。number(float32) 类型，取值范围：[0, 1.5]。默认值为 0.5。

## 响应参数

| 参数名 | 类型 | 是否必需 | 描述 |
| :--- | :--- | :--- | :--- |
| `task_id` | string | 是 | 异步任务的 ID。您需要使用此 `task_id` 调用 [查询任务结果 API](/docs/models/reference-get-async-task-result) 以获取生成结果。 |

## 请求示例

```bash
curl --request POST \
  --url https://api.ppinfra.com/v3/async/inpainting \
  --header 'Authorization: Bearer <your_api_key>' \
  --header 'Content-Type: application/json' \
  --data '
{
  "extra": {
    "response_image_type": "png"
  },
  "request": {
    "model_name": "<inpainting_model_name>",
    "image_base64": "<base64_string_of_image>",
    "mask_image_base64": "<base64_string_of_mask>",
    "prompt": "a beautiful sunset over mountains",
    "image_num": 2,
    "steps": 30,
    "guidance_scale": 7.5,
    "sampler_name": "Euler a",
    "mask_blur": 4,
    "negative_prompt": "blurry, ugly",
    "sd_vae": "<vae_model_name>",
    "seed": 42,
    "loras": [
      {
        "model_name": "<lora_model_name>",
        "strength": 0.8
      }
    ],
    "embeddings": [
      {
        "model_name": "<embedding_model_name>"
      }
    ],
    "clip_skip": 2,
    "strength": 0.75,
    "inpainting_full_res": 0,
    "inpainting_full_res_padding": 8,
    "inpainting_mask_invert": 0,
    "initial_noise_multiplier": 0.5
  }
}
'
```

## 响应示例

```json
{
  "task_id": "task_1234567890abcdef"
}
```