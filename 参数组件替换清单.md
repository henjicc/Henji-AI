# 参数组件替换清单

以下清单用于推动将现有页面内的分散参数控件统一替换为通用组件（Dropdown/Toggle/NumberInput/TextInput/ParamRow），并在后续抽象复杂面板与上传器，形成模块化、可复用的适配层。

## 已完成（示例性替换与验证）
- MediaGenerator 顶部参数行容器：改为 `ParamRow`，统一视觉间距与对齐（src/components/MediaGenerator.tsx:1258）。
- 风格（Vidu 文生视频）：改为 `Dropdown`（src/components/MediaGenerator.tsx:1952-1999）。
- 提示词优化（Minimax Hailuo）：改为 `Toggle`（src/components/MediaGenerator.tsx:2341-2346）。
- CFG Scale（Kling）：改为 `NumberInput`（src/components/MediaGenerator.tsx:2299-2339）。
- 通用负面提示：改为 `TextInput`（src/components/MediaGenerator.tsx:2531-2541）。

## 待替换 · 下拉类（统一为 Dropdown）
- 模型选择器内子参数：
  - 模式（Vidu）：src/components/MediaGenerator.tsx:1852-1897
  - 宽高比（Vidu）：src/components/MediaGenerator.tsx:1901-1944
  - 运动幅度（Vidu）：src/components/MediaGenerator.tsx:1996-2043
  - BGM（Vidu）：src/components/MediaGenerator.tsx:2046-2090
- 音频模型（Minimax Speech）参数：
  - 规格：src/components/MediaGenerator.tsx:1507-1549
  - 音色：src/components/MediaGenerator.tsx:1551-1606（复杂面板，可用 Dropdown.renderPanel 承载）
  - 情绪：src/components/MediaGenerator.tsx:1609-1651
  - 语言增强：src/components/MediaGenerator.tsx:1653-1695
  - 采样率：src/components/MediaGenerator.tsx:1738-1749
  - 比特率：src/components/MediaGenerator.tsx:1761-1776
  - 格式：src/components/MediaGenerator.tsx:1783-1798
  - 声道：src/components/MediaGenerator.tsx:1805-1825
- 视频模型参数：
  - 时长（Kling/Hailuo）：src/components/MediaGenerator.tsx:2095-2154
  - 宽高比（Kling/PixVerse）：src/components/MediaGenerator.tsx:2157-2218
  - 分辨率（PixVerse/Hailuo/Wan）：src/components/MediaGenerator.tsx:2221-2281、2383-2413
  - 版本（Seedance）：src/components/MediaGenerator.tsx:2433-2463
  - 分辨率（Seedance）：src/components/MediaGenerator.tsx:2465-2493
  - 宽高比（Seedance）：src/components/MediaGenerator.tsx:2494-2522

## 待替换 · 开关类（统一为 Toggle）
- Fast/快速模式：
  - PixVerse 快速模式：src/components/MediaGenerator.tsx:2292-2297
  - Hailuo Fast 模式：src/components/MediaGenerator.tsx:2284-2287
- 智能改写与音频（Wan）：src/components/MediaGenerator.tsx:2415-2423
- 相机固定（Seedance）：src/components/MediaGenerator.tsx:2523-2526
- 批量生成（Seedream）：src/components/MediaGenerator.tsx:2550-2593（可用 Toggle；提示气泡另行保留）

## 待替换 · 数字输入类（统一为 NumberInput）
- 音频高级项：
  - 音量：src/components/MediaGenerator.tsx:1707-1715
  - 语调：src/components/MediaGenerator.tsx:1717-1725
  - 速度：src/components/MediaGenerator.tsx:1727-1735
- 视频随机种子：src/components/MediaGenerator.tsx:2538-2541
- SettingsModal：历史记录保存数量（可用 NumberInput）：src/components/SettingsModal.tsx:120-141

## 待替换 · 文本输入类（统一为 TextInput）
- Wan 模型负面提示：src/components/MediaGenerator.tsx:2425-2427
- 其他模型专用负面提示处，如有重复 input 控件时统一替换（可在各模型块内搜索 `label="负面提示"`）。
- SettingsModal：API 密钥输入（保留 password 类型；可在 TextInput 扩展 `type="password"` 支持）。

## 待抽象 · 复杂面板（用 Dropdown.renderPanel 或 PanelTrigger）
- 模型选择器大面板：src/components/MediaGenerator.tsx:1261-1357
- 分辨率设置悬浮窗口：src/components/MediaGenerator.tsx:1361-1501
- 音色选择大面板：src/components/MediaGenerator.tsx:1551-1606

进展：已统一使用 PanelTrigger，修复首次弹出定位，移除固定高度，以上方弹出为准并保持底部边缘位置一致。

抽象目标：统一触发器样式与弹层动画、固定位置算法、滚动行为与遮罩层；内容由调用方传入 renderPanel 自定义。

## 待抽象 · 上传器（图片/视频/音频）
- 现有图片上传/预览/删除：src/components/MediaGenerator.tsx:2629-2704、2795-2803

抽象目标：统一缩略图、删除按钮、拖拽/粘贴接入、隐藏文件输入；对外暴露 `accept/multiple/maxCount/onFiles`；后续按模型 schema 自动设置文件类型与数量上限。

## 布局一致性
- 顶部参数行已统一为 `ParamRow`；建议在所有参数区块使用该容器，避免宽度不一致导致的视觉间距不统一（可逐段替换当前 `div.flex flex-wrap gap-...`）。

## 联动与禁用策略（建议）
- 为 Dropdown 等组件加入选项禁用策略（如 `isOptionDisabled(opt, state)`），用于表达“分辨率受时长限制”等约束，避免联动逻辑分散在页面。
- 推进参数 schema：在 `src/types/` 定义各供应商/模型的参数元数据（类型、范围、枚举、默认值、依赖），由渲染器自动选择组件与属性，统一联动校验。

## 代码清理（构建报错相关）
- 未使用状态/变量清理：示例（文件:行号）
  - src/components/MediaGenerator.tsx:22、25、46、54、64、73、100、996、1088
  - src/App.tsx:35、43、44、74、624、758、808
  - src/components/AudioPlayer.tsx:19、20、90
- 样式类型报错（WebkitAppRegion）：
  - src/components/WindowControls.tsx:31、37（考虑为 `any` 包裹或改用 `data-tauri-drag-region` 等方式）
- 其他类型修复：
  - src/services/api.ts:98（`data?.message` 需加类型定义）
  - src/utils/save.ts:192-193（`BlobPart`/`ArrayBuffer` 类型修正）
  - `pica` 类型声明：为 `pica` 增加 d.ts 或安装 `@types/pica`（若存在）

---

备注：以上行号来自当前代码快照的检索结果，用于定位与替换参考；后续提交前建议进行统一替换与一次构建验证，逐步消除构建报错并完成组件抽象。

## 待办事项清单
- [x] 统一替换下拉控件（Vidu：模式/宽高比/运动幅度/BGM）为 `Dropdown`
- [x] 统一替换音频参数下拉（规格/情绪/语言增强/采样率/比特率/格式/声道）为 `Dropdown`（音色面板用 `renderPanel`）
  - [x] 规格（HD/Turbo）
  - [x] 情绪（neutral/happy/...）
  - [x] 语言增强（多语种）
  - [x] 采样率（8k/16k/22.05k/24k/32k/44.1k）
  - [x] 比特率（32k/64k/128k/256k）
  - [x] 格式（mp3/pcm/flac/wav）
  - [x] 声道（1/2）
- [x] 统一替换视频参数下拉（时长/宽高比/分辨率/版本）为 `Dropdown`
  - [x] Kling/PixVerse 宽高比
  - [x] PixVerse 分辨率
  - [x] Hailuo 分辨率
  - [x] Wan 尺寸与分辨率
  - [x] Seedance 版本/分辨率/宽高比
- [x] 将 PixVerse 快速模式、Hailuo Fast 模式、Wan 智能改写与音频、Seedance 相机固定改为 `Toggle`
  - [x] PixVerse 快速模式
  - [x] Hailuo Fast 模式
  - [x] Wan 智能改写与音频
  - [x] Seedance 相机固定
- [x] 将音量/语调/速度、随机种子、SettingsModal 历史记录数量改为 `NumberInput`
  - [x] 音量/语调/速度（音频高级面板）
  - [x] 随机种子（视频参数）
  - [x] 历史记录数量（SettingsModal）
- [x] 将所有“负面提示”与常规文本输入改为 `TextInput`（扩展支持 `type="password"` 用于 API 密钥）
  - [x] Wan 负面提示
  - [x] 通用负面提示（除特定模型）
- [x] 抽象“复杂面板触发器”（模型选择器、分辨率设置、音色面板）为通用触发+弹层组件
  - [x] 创建通用 PanelTrigger 组件（Portal 固定定位、zIndex、对齐、宽度）
  - [x] 集成模型选择器大面板
  - [x] 集成分辨率设置悬浮窗口
  - [x] 集成音色选择大面板
  - [x] MiniMax Speech 高级选项改为 PanelTrigger
  - [x] 新增 PanelTrigger 特性：按面板场景控制“点击面板后是否自动关闭”
    - [x] 模型/音色：点击面板内项目后自动关闭
    - [x] 即梦4.0分辨率、MiniMax高级面板：面板内操作不自动关闭，可连续设置
  - [x] 稳定首次上方弹出定位，移除固定高度并统一底部对齐
- [x] 抽象统一“上传器”（图片/视频/音频），支持 `accept/multiple/maxCount/onFiles` 与拖拽/粘贴
- [ ] 将所有参数区块的行容器统一替换为 `ParamRow`，确保不同宽度组件的视觉间距一致
- [ ] 为 `Dropdown` 等组件接入选项禁用策略，表达联动约束（分辨率受时长限制等）
- [ ] 在 `src/types/` 定义参数 schema，并实现表单渲染器按 schema 自动选择组件与属性
- [ ] 清理未使用状态与变量，修复类型问题（WindowControls 样式、api.ts、save.ts、pica 类型声明）
- [ ] 统一运行构建与页面预览验证，保证替换后行为与样式一致