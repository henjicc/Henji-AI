## 现状与问题
- 上传图片在 `MediaGenerator.tsx` 里通过 `FileReader.readAsDataURL` 存入 `uploadedImages`（Data URL），未落盘。
- 生成时把 `uploadedImages` 直接作为 `options.images` 传入，后续历史删除仅处理生成结果的 `filePath`，无法删除上传的原始图片。

## 目标
- 所有“上传图片”落盘到应用数据目录，并在删除单条/全部历史时一并删除。
- 目录结构清晰：`AppLocalData/com.henji.ai/Henji-AI/Uploads` 专门保存上传文件；生成结果仍在 `Henji-AI/Media`。
- 生成流程仍可使用 Data URL（后端 API 兼容性最好），但从本地文件读取并转换为 Data URL。

## 设计
- 新建保存工具 `saveUploadImage(blob | file)`：
  - 写入：`BaseDirectory.AppLocalData` + `Henji-AI/Uploads/<timestamp>-<random>.<ext>`
  - 返回：`fullPath`（用于删除）、`displaySrc`（本地 blob URL 用于缩略图）
- 上传通道调整：
  - 文件选择与剪贴板粘贴：不再直接 set Data URL；改为先落盘 → 读取成 Data URL（用于生成）与 `displaySrc`（用于 UI）
  - `uploadedImages` 改为包含 Data URL（用于生成），并新增 `uploadedFilePaths` 存储每张上传图的本地路径（用于删除）
- 生成逻辑不变：
  - `options.images` 继续使用 Data URL 以兼容当前适配器与 API。
- 历史记录结构扩展：
  - 在任务 `result.filePath`（生成结果）之外，任务对象新增 `uploadedFilePaths: string[]`（上传原始图路径）。
- 删除策略：
  - 删除单条历史：删除 `result.filePath`（支持 `|||` 多路径）+ 删除 `uploadedFilePaths` 全部文件。
  - 清除全部历史：遍历所有任务，删除生成结果与上传原始图的全部文件。

## 具体改动
- 新增/更新工具（`src/utils/save.ts`）
  - `saveUploadImage(fileOrBlob)`：写入 Uploads 目录，返回 `{ fullPath, displaySrc, dataUrl }`
  - `fileToDataUrl(fullPath)`：从本地读取并转 Data URL（用于生成）
- 修改上传组件（`src/components/MediaGenerator.tsx`）
  - `handleImageFileUpload`：对每个文件执行 `saveUploadImage` → `setUploadedImages(dataUrl)`、`setUploadedFilePaths(fullPath)`、用于 UI 的 `displaySrc`
  - `handlePaste`：同上，对剪贴板 blob 执行落盘
  - 计算智能分辨率改为基于 `displaySrc` 或 Data URL 第一张图
  - 传参：生成时 `options.images = uploadedImages`（Data URL）
- 任务记录（`src/App.tsx`）
  - 在创建任务时把当前 `uploadedFilePaths` 放入任务对象（如 `uploadedFilePaths: [...]`）
  - 历史删除：
    - 单条：先删除 `task.result.filePath`（支持多路径），再删除 `task.uploadedFilePaths`，最后移除该任务
    - 全部：遍历所有任务执行同样删除，再清空列表与 `localStorage`
- 能力权限（`src-tauri/capabilities/default.json`）
  - 已有 `fs:allow-write` / `fs:allow-remove` 权限覆盖 `Henji-AI/**/*`，无需额外配置；若没有则补充 `Uploads` 路径的写入/删除。

## 验证
- 上传 1～N 张图，检查 `C:\Users\<你>\AppData\Local\com.henji.ai\Henji-AI\Uploads` 是否产生文件。
- 生成图片与视频，检查 `Media` 目录是否产生结果文件。
- 删除单条与清除全部历史，确认 `Uploads` 与 `Media` 对应文件均被移除。

## 兼容与边界
- 旧历史任务没有 `uploadedFilePaths`，删除时跳过该部分。
- 若某文件不存在或被外部占用，删除异常会